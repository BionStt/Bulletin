{% extends "group_base.html" %}

{# comment: load custom gravatar filter #}
{% load gravatar %}

{% block maincontent %}
<form id="post_form" method="post" class="well">
	<img class="pull-left" src="{{ user.email|gravatar:'60' }}" alt="user's gravatar" />
	<textarea class="input-block-level pull-left" placeholder="Communicate with your group..." id="id_message" rows="10" cols="40" name="message"></textarea>
	<input type="submit" value="Post" class="btn pull-right btn-primary" />
    {% csrf_token %}
</form>

{% if post_list %}
<ul id="posts" class="media-list">
    {% for post in post_list %}
    	{% include "group_post.html" %}
    {% endfor %}
</ul>
{% else %}
<div class="alert alert-error">
    No posts are available.
</div>
{% endif %}

{% endblock maincontent %}

{% block extrajs %}
{{ block.super }}
<script src="{{ STATIC_URL }}js/md5.js" type="text/javascript"></script>
<script>
$(document).ready(function() {
    /* Automatically makes an ajax call to 'update/' view
     * times out after 40s
     * after timeout or sucess, recursively calls itself again
     */
    (function update() {
        $.ajax({url: "update/", success: function(data) {
        	if ($(data).hasClass("comment")) {
                // returned data is a comment
                var postID = "#post-" + $(data).attr("post");
                $(postID).find('.comments').append(data);
            } else if ($(data).hasClass("post")) {
                // returned data is a post
                // TODO implement
            }
        }, dataType: "html", complete: update, timeout: 40000});
    })();
});
</script>
{% endblock extrajs %}
